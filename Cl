-- ============================================================
--  AUTO TOWER V10
--  - QuÃ©t Táº¤T Cáº¢ thÃ¡p trÃªn base (ká»ƒ cáº£ khÃ´ng cÃ³ trong hotbar)
--  - TÃ­ch chá»n thÃ¡p nÃ o muá»‘n nÃ¢ng
--  - Balanced: nÃ¢ng Ä‘á»u táº¥t cáº£ Ä‘Ã£ tÃ­ch
--  - Focus: nÃ¢ng full 1 cÃ¡i má»›i chuyá»ƒn sang cÃ¡i tiáº¿p
--  Buy:     Hotbar:FireServer("buy", towerID, tilePart)
--  Upgrade: Upgrade:FireServer("upgrade", towerModel)
-- ============================================================

local Players  = game:GetService("Players")
local RS       = game:GetService("ReplicatedStorage")
local UIS      = game:GetService("UserInputService")
local LP       = Players.LocalPlayer

-- XoÃ¡ UI cÅ©
for _, g in ipairs({LP.PlayerGui, game.CoreGui}) do
    local o = g:FindFirstChild("TowerUI")
    if o then o:Destroy() end
end

local Remotes       = RS:WaitForChild("Remotes")
local BuildRemote   = Remotes:WaitForChild("Hotbar")
local UpgradeRemote = Remotes:WaitForChild("Upgrade")

-- ============================================================
-- MAP tÃªn hiá»ƒn thá»‹ â†” ID gá»­i server
-- ThÃªm vÃ o Ä‘Ã¢y náº¿u cÃ³ thÃ¡p má»›i
-- ============================================================
local DISPLAY_TO_ID = {
    ["Crossbow"]    = "Turret1",
    ["Carrot Farm"] = "Farm1",
    ["Farm"]        = "Farm1",
}

-- QuÃ©t Hud láº¥y danh sÃ¡ch thÃ¡p tá»« UI tháº­t cá»§a game
local function scanHotbarTowers()
    local hud = game.Players.LocalPlayer.PlayerGui:FindFirstChild("Hud")
    local result = {}
    local seen = {}

    if hud then
        for _, v in ipairs(hud:GetDescendants()) do
            if (v:IsA("TextLabel") or v:IsA("TextButton")) then
                local txt = v.Text or ""
                local id = DISPLAY_TO_ID[txt]
                if id and not seen[id] then
                    seen[id] = true
                    -- Láº¥y giÃ¡: tÃ¬m TextLabel anh em cÃ³ dáº¥u $
                    local cost = 0
                    if v.Parent then
                        for _, sib in ipairs(v.Parent:GetDescendants()) do
                            if sib ~= v and (sib:IsA("TextLabel") or sib:IsA("TextButton")) then
                                local t = sib.Text or ""
                                if t:find("%$") then
                                    local num = t:match("%d+")
                                    if num then cost = tonumber(num) or 0 end
                                    break
                                end
                            end
                        end
                    end
                    table.insert(result, { name = txt, id = id, cost = cost })
                end
            end
        end
    end

    -- Fallback
    if #result == 0 then
        result = {
            { name = "Crossbow",    id = "Turret1", cost = 50 },
            { name = "Carrot Farm", id = "Farm1",   cost = 90 },
        }
    end
    return result
end

local BUY_TOWERS = scanHotbarTowers()

-- ============================================================
-- STATE
-- ============================================================
local AUTO_UPGRADE  = false
local MODE          = "Balanced"   -- "Balanced" hoáº·c "Focus"
local SELECTED      = {}           -- [modelName_tileIndex] = true
local UPGRADE_DELAY = 0.8
local checkboxBtns  = {}           -- ref Ä‘á»ƒ update UI
local towerCache = {}
-- ============================================================
-- HÃ€M TIá»†N ÃCH
-- ============================================================
local function getMoney()
    -- Tiá»n lÆ°u trong Player attribute "currency"
    return LP:GetAttribute("currency") or 0
end

-- Láº¥y level hiá»‡n táº¡i cá»§a thÃ¡p
local function getTowerLevel(model)
    return model:GetAttribute("level") or model:GetAttribute("Level") or 0
end

-- Max level: Farm* = 5, cÃ²n láº¡i (sÃºng/thÃ¡p) = 10
local function getMaxLevel(model)
    local name = model.Name:lower()
    if name:find("farm") then return 5 end
    return 10
end

local function isMaxLevel(model)
    return getTowerLevel(model) >= getMaxLevel(model)
end

local function getTileUnderFoot()
    local char = LP.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {char}
    params.FilterType = Enum.RaycastFilterType.Exclude
    local res = workspace:Raycast(char.HumanoidRootPart.Position, Vector3.new(0,-15,0), params)
    return res and res.Instance or nil
end

local function getMyBase()
    local char = LP.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return nil end
    local bases = workspace:FindFirstChild("Bases")
    if not bases then return nil end
    for _, b in ipairs(bases:GetChildren()) do
        local owner = b:FindFirstChild("Owner")
        if owner and owner.Value == LP then return b end
    end
    -- fallback: base gáº§n nháº¥t
    local nearest, dist = nil, 300
    for _, b in ipairs(bases:GetChildren()) do
        local bp = b:FindFirstChild("Base") or b:FindFirstChildWhichIsA("BasePart")
        if bp then
            local d = (char.HumanoidRootPart.Position - bp.Position).Magnitude
            if d < dist then dist = d; nearest = b end
        end
    end
    return nearest
end

-- Tráº£ vá» list {model, key} cá»§a táº¥t cáº£ thÃ¡p trÃªn base
local function getAllTowers(base)
    local list = {}

    for _, obj in ipairs(base:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("HumanoidRootPart") then
            local key = obj:GetDebugId()

            table.insert(list, {
                model = obj,
                key = key,
                displayName = obj.Name
            })
        end
    end
    return list
end
-- ============================================================
-- UI - LAYOUT NGANG (2 cá»™t)
-- ============================================================
local sg = Instance.new("ScreenGui")
sg.Name = "TowerUI"; sg.ResetOnSpawn = false
sg.DisplayOrder = 999; sg.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
sg.Parent = LP.PlayerGui

-- Panel ngang: rá»™ng 420, cao vá»«a Ä‘á»§
local panel = Instance.new("Frame")
panel.Size = UDim2.new(0, 420, 0, 310)
panel.Position = UDim2.new(0.5, -210, 1, -320)  -- bÃ¡m Ä‘Ã¡y mÃ n hÃ¬nh
panel.BackgroundColor3 = Color3.fromRGB(12,12,22)
panel.BackgroundTransparency = 0.08
panel.BorderSizePixel = 0; panel.Parent = sg
Instance.new("UICorner", panel).CornerRadius = UDim.new(0,14)
local pStroke = Instance.new("UIStroke", panel)
pStroke.Color = Color3.fromRGB(99,102,241); pStroke.Thickness = 1.5; pStroke.Transparency = 0.4

-- Header (kÃ©o Ä‘Æ°á»£c)
local header = Instance.new("Frame")
header.Size = UDim2.new(1,0,0,26)
header.BackgroundColor3 = Color3.fromRGB(99,102,241)
header.BorderSizePixel = 0; header.Parent = panel
Instance.new("UICorner", header).CornerRadius = UDim.new(0,14)
local hpatch = Instance.new("Frame")
hpatch.Size = UDim2.new(1,0,0,10); hpatch.Position = UDim2.new(0,0,1,-10)
hpatch.BackgroundColor3 = Color3.fromRGB(99,102,241); hpatch.BorderSizePixel = 0; hpatch.Parent = header

local hTitle = Instance.new("TextLabel")
hTitle.Size = UDim2.new(0,200,1,0); hTitle.Position = UDim2.new(0,8,0,0)
hTitle.BackgroundTransparency = 1; hTitle.Text = "AUTO TOWER V10"
hTitle.TextColor3 = Color3.fromRGB(255,255,255); hTitle.TextSize = 12
hTitle.Font = Enum.Font.GothamBold; hTitle.TextXAlignment = Enum.TextXAlignment.Left
hTitle.Parent = header

-- Tiá»n á»Ÿ header bÃªn pháº£i
local moneyLbl = Instance.new("TextLabel")
moneyLbl.Size = UDim2.new(0,140,1,0); moneyLbl.Position = UDim2.new(1,-148,0,0)
moneyLbl.BackgroundTransparency = 1; moneyLbl.Text = "ðŸ’° $---"
moneyLbl.TextColor3 = Color3.fromRGB(250,204,21); moneyLbl.TextSize = 12
moneyLbl.Font = Enum.Font.GothamBold; moneyLbl.TextXAlignment = Enum.TextXAlignment.Right
moneyLbl.Parent = header

task.spawn(function()
    while panel.Parent do
        moneyLbl.Text = "ðŸ’° $" .. tostring(getMoney())
        task.wait(0.3)
    end
end)

-- Drag
local dragging, dragStart, startPos = false, nil, nil
header.InputBegan:Connect(function(inp)
    if inp.UserInputType == Enum.UserInputType.MouseButton1
    or inp.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = Vector2.new(inp.Position.X, inp.Position.Y)
        startPos = panel.Position
    end
end)
UIS.InputChanged:Connect(function(inp)
    if dragging and (inp.UserInputType == Enum.UserInputType.MouseMovement
    or inp.UserInputType == Enum.UserInputType.Touch) then
        local d = Vector2.new(inp.Position.X, inp.Position.Y) - dragStart
        panel.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + d.X,
                                    startPos.Y.Scale, startPos.Y.Offset + d.Y)
    end
end)
UIS.InputEnded:Connect(function(inp)
    if inp.UserInputType == Enum.UserInputType.MouseButton1
    or inp.UserInputType == Enum.UserInputType.Touch then dragging = false end
end)

-- Helper button
local function makeBtn(parent, text, color, x, y, w, h)
    h = h or 30; w = w or 120
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,w,0,h); btn.Position = UDim2.new(0,x,0,y)
    btn.BackgroundColor3 = color; btn.BorderSizePixel = 0
    btn.Text = text; btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.TextSize = 10; btn.Font = Enum.Font.GothamBold
    btn.AutoButtonColor = false; btn.Parent = parent
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,7)
    return btn
end

local function makeLbl(parent, text, x, y, w, h, color, size)
    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(0,w,0,h or 14); l.Position = UDim2.new(0,x,0,y)
    l.BackgroundTransparency = 1; l.Text = text
    l.TextColor3 = color or Color3.fromRGB(148,163,184); l.TextSize = size or 10
    l.Font = Enum.Font.GothamBold; l.TextXAlignment = Enum.TextXAlignment.Left
    l.Parent = parent
    return l
end

-- ============================================================
-- Cá»˜T TRÃI: MUA THÃP (x=6, width=196)
-- ============================================================
makeLbl(panel, "MUA THÃP", 8, 30, 190, 14, Color3.fromRGB(148,163,184), 10)

local buyBtns = {}  -- ref cÃ¡c nÃºt mua Ä‘á»ƒ xoÃ¡ khi refresh

local function rebuildBuyButtons()
    -- XoÃ¡ nÃºt cÅ©
    for _, b in ipairs(buyBtns) do
        if b and b.Parent then b:Destroy() end
    end
    buyBtns = {}

    BUY_TOWERS = scanHotbarTowers()
    local buyY = 46
    for _, t in ipairs(BUY_TOWERS) do
        local label = t.name .. (t.cost > 0 and ("  $"..t.cost) or "")
        local btn = makeBtn(panel, label, Color3.fromRGB(30,80,150), 8, buyY, 190, 28)
        table.insert(buyBtns, btn)
        local orig = label
        btn.MouseButton1Click:Connect(function()
            local tile = getTileUnderFoot()
            if tile then
                BuildRemote:FireServer("buy", t.id, tile)
                btn.Text = t.name .. " âœ“"
            else
                btn.Text = "Khong thay tile!"
            end
            task.delay(1.2, function() btn.Text = orig end)
        end)
        buyY += 32
    end
end

rebuildBuyButtons()

-- Tá»± refresh nÃºt mua má»—i 3s (khi hotbar game thay Ä‘á»•i)
task.spawn(function()
    while panel.Parent do
        task.wait(3)
        rebuildBuyButtons()
    end
end)

-- Separator dá»c
local sepV = Instance.new("Frame")
sepV.Size = UDim2.new(0,1,1,-30); sepV.Position = UDim2.new(0,208,0,28)
sepV.BackgroundColor3 = Color3.fromRGB(60,60,80); sepV.BorderSizePixel = 0; sepV.Parent = panel

-- ============================================================
-- Cá»˜T PHáº¢I: NÃ‚NG Cáº¤P (x=214, width=200)
-- ============================================================
makeLbl(panel, "THÃP NÃ‚NG Cáº¤P", 214, 30, 200, 14, Color3.fromRGB(148,163,184), 10)

-- ScrollingFrame checkbox
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(0,196,0,120)
scrollFrame.Position = UDim2.new(0,214,0,46)
scrollFrame.BackgroundColor3 = Color3.fromRGB(6,6,16)
scrollFrame.BackgroundTransparency = 0.3
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 3
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(99,102,241)
scrollFrame.CanvasSize = UDim2.new(0,0,0,0)
scrollFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
scrollFrame.Parent = panel
Instance.new("UICorner", scrollFrame).CornerRadius = UDim.new(0,6)
local scrollLayout = Instance.new("UIListLayout", scrollFrame)
scrollLayout.Padding = UDim.new(0,2)
Instance.new("UIPadding", scrollFrame).PaddingTop = UDim.new(0,3)

-- Row 1: QuÃ©t + Chá»n táº¥t cáº£
local scanBtn    = makeBtn(panel, "ðŸ” Da quet", Color3.fromRGB(79,70,229),  214, 170, 94, 26)
local selAllBtn  = makeBtn(panel, "Chá»n táº¥t cáº£",  Color3.fromRGB(55,65,81),   312, 170, 98, 26)

-- Row 2: Mode + Auto
local modeBtn = makeBtn(panel, "âš– Balanced", Color3.fromRGB(14,116,144), 214, 200, 94, 26)
local autoBtn = makeBtn(panel, "â–¶ Auto: OFF", Color3.fromRGB(150,50,50),  312, 200, 98, 26)

-- Row 3: NÃ¢ng 1 láº§n + Status
local manualBtn = makeBtn(panel, "NÃ¢ng 1 láº§n", Color3.fromRGB(22,163,74), 214, 230, 94, 26)
local statusLbl = makeLbl(panel, "San sang", 312, 234, 100, 20, Color3.fromRGB(130,130,130), 10)

-- ============================================================
-- LOGIC TÃCH CHá»ŒN
-- ============================================================
local function rebuildCheckboxes()
    -- XoÃ¡ cÅ© nhÆ°ng GIá»® NGUYÃŠN tráº¡ng thÃ¡i SELECTED
    for _, c in ipairs(scrollFrame:GetChildren()) do
        if c:IsA("Frame") then c:Destroy() end
    end
    checkboxBtns = {}

    local base = getMyBase()
    if not base then
        statusLbl.Text = "Khong thay base!"
        return
    end

    for _, info in ipairs(newCache) do
        local exists = false

        for _, old in ipairs(towerCache) do
            if old.key == info.key then
                exists = true
                break
            end
        end

        if not exists then
            table.insert(towerCache, info)
        end
    end

    -- Chá»‰ rebuild náº¿u sá»‘ thÃ¡p thay Ä‘á»•i (trÃ¡nh flicker)
    if #newCache == #towerCache then
        -- Kiá»ƒm tra cÃ³ thÃ¡p má»›i khÃ´ng
        local same = true
        for i, info in ipairs(newCache) do
            if not towerCache[i] or towerCache[i].key ~= info.key then
                same = false; break
            end
        end
        if same then return end
    end

    towerCache = newCache

    if #towerCache == 0 then
        statusLbl.Text = "Base chua co thap nao"
        return
    end

    statusLbl.Text = #towerCache .. " thap"

    for _, info in ipairs(towerCache) do
        local row = Instance.new("Frame")
        row.Size = UDim2.new(1,-4,0,28)
        row.BackgroundTransparency = 1
        row.BorderSizePixel = 0
        row.Parent = scrollFrame

        -- Checkbox button
        local cb = Instance.new("TextButton")
        cb.Size = UDim2.new(0,20,0,20)
        cb.Position = UDim2.new(0,4,0.5,-10)
        cb.BackgroundColor3 = SELECTED[info.key] and Color3.fromRGB(22,163,74) or Color3.fromRGB(50,50,70)
        cb.Text = SELECTED[info.key] and "âœ”" or ""
        cb.TextColor3 = Color3.fromRGB(255,255,255)
        cb.TextSize = 12; cb.Font = Enum.Font.GothamBold
        cb.BorderSizePixel = 0; cb.AutoButtonColor = false
        cb.Parent = row
        Instance.new("UICorner", cb).CornerRadius = UDim.new(0,5)

        -- Label tÃªn thÃ¡p
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1,-30,1,0)
        lbl.Position = UDim2.new(0,28,0,0)
        lbl.BackgroundTransparency = 1
        lbl.Text = info.displayName
        lbl.TextColor3 = Color3.fromRGB(210,210,210)
        lbl.TextSize = 11; lbl.Font = Enum.Font.Gotham
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.Parent = row

        local key = info.key
        cb.MouseButton1Click:Connect(function()
            SELECTED[key] = not SELECTED[key]
            cb.Text = SELECTED[key] and "âœ”" or ""
            cb.BackgroundColor3 = SELECTED[key] and Color3.fromRGB(22,163,74) or Color3.fromRGB(50,50,70)
        end)

        table.insert(checkboxBtns, {cb = cb, key = key})
    end
end

-- Auto quÃ©t má»—i 2 giÃ¢y
scanBtn.MouseButton1Click:Connect(rebuildCheckboxes)
task.spawn(function()
    while panel.Parent do
        task.wait(2)
        rebuildCheckboxes()
    end
end)

-- Chá»n / bá» chá»n táº¥t cáº£
local allSelected = false
selAllBtn.MouseButton1Click:Connect(function()
    allSelected = not allSelected
    selAllBtn.Text = allSelected and "Bá» chá»n táº¥t cáº£" or "Chá»n táº¥t cáº£"
    for _, info in ipairs(towerCache) do
        SELECTED[info.key] = allSelected
    end
    for _, item in ipairs(checkboxBtns) do
        item.cb.Text = allSelected and "âœ”" or ""
        item.cb.BackgroundColor3 = allSelected and Color3.fromRGB(22,163,74) or Color3.fromRGB(50,50,70)
    end
end)

-- Mode toggle
modeBtn.MouseButton1Click:Connect(function()
    MODE = MODE == "Balanced" and "Focus" or "Balanced"
    if MODE == "Balanced" then
        modeBtn.Text = "âš– BALANCED - NÃ¢ng Ä‘á»u"
        modeBtn.BackgroundColor3 = Color3.fromRGB(14,116,144)
    else
        modeBtn.Text = "ðŸŽ¯ FOCUS - Full 1 cÃ¡i"
        modeBtn.BackgroundColor3 = Color3.fromRGB(124,58,237)
    end
end)

-- Auto toggle
autoBtn.MouseButton1Click:Connect(function()
    AUTO_UPGRADE = not AUTO_UPGRADE
    autoBtn.Text = "â–¶ AUTO UPGRADE: " .. (AUTO_UPGRADE and "ON" or "OFF")
    autoBtn.BackgroundColor3 = AUTO_UPGRADE and Color3.fromRGB(22,163,74) or Color3.fromRGB(150,50,50)
end)

-- ============================================================
-- HÃ€M NÃ‚NG Cáº¤P
-- ============================================================
local function getSelectedTowers()
    local base = getMyBase()
    if not base then return {} end
    local all = getAllTowers(base)
    local filtered = {}
    for _, info in ipairs(all) do
        if SELECTED[info.key] then
            table.insert(filtered, info.model)
        end
    end
    -- Náº¿u khÃ´ng tÃ­ch gÃ¬ â†’ nÃ¢ng táº¥t cáº£
    if #filtered == 0 then
        for _, info in ipairs(all) do
            table.insert(filtered, info.model)
        end
    end
    return filtered
end

-- Láº¥y cost tá»« BillboardGui "Upgrade" trÃªn thÃ¡p (náº¿u cÃ³)
local function getUpgradeCost(model)
    for _, v in ipairs(model:GetDescendants()) do
        if v:IsA("BillboardGui") and v.Name == "Upgrade" then
            -- TÃ¬m TextLabel cÃ³ sá»‘ tiá»n
            for _, lbl in ipairs(v:GetDescendants()) do
                if lbl:IsA("TextLabel") then
                    local num = lbl.Text:gsub("[^%d]", "")
                    local n = tonumber(num)
                    if n and n > 0 then return n end
                end
            end
        end
    end
    return 0  -- 0 = khÃ´ng biáº¿t cost, cá»© thá»­
end

local function canAfford(model)
    local cost = getUpgradeCost(model)
    if cost == 0 then return true end  -- khÃ´ng Ä‘á»c Ä‘Æ°á»£c cost thÃ¬ cá»© thá»­
    return getMoney() >= cost
end

local function doUpgradeBalanced(towers)
    local upgraded = 0
    local maxed = 0
    for _, tw in ipairs(towers) do
        if not tw or not tw.Parent then continue end
        if isMaxLevel(tw) then
            maxed += 1
            continue
        end
        if canAfford(tw) then
            UpgradeRemote:FireServer("upgrade", tw)
            upgraded += 1
        else
            statusLbl.Text = "Thieu tien: " .. tw.Name .. " (lv" .. getTowerLevel(tw) .. ")"
        end
        task.wait(0.15)
    end
    if maxed == #towers then
        statusLbl.Text = "Tat ca da MAX level!"
        AUTO_UPGRADE = false
        autoBtn.Text = "â–¶ AUTO UPGRADE: OFF"
        autoBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    end
end

local function doUpgradeFocus(towers)
    -- Focus: nÃ¢ng 1 cÃ¡i Ä‘áº¿n lv max rá»“i má»›i chuyá»ƒn cÃ¡i tiáº¿p
    -- Farm max = lv5, sÃºng/thÃ¡p max = lv10
    for _, tw in ipairs(towers) do
        if not tw or not tw.Parent then continue end

        local maxLv = getMaxLevel(tw)

        while AUTO_UPGRADE do
            if not tw or not tw.Parent then break end

            local curLv = getTowerLevel(tw)
            if curLv >= maxLv then
                statusLbl.Text = tw.Name .. " MAX (lv" .. curLv .. ") â†’ next"
                task.wait(0.3)
                break
            end

            if not canAfford(tw) then
                statusLbl.Text = "Cho tien: " .. tw.Name .. " lv" .. curLv .. "/" .. maxLv
                task.wait(0.5)
                continue
            end

            UpgradeRemote:FireServer("upgrade", tw)
            statusLbl.Text = "Focus: " .. tw.Name .. " lv" .. curLv .. " â†’ " .. maxLv
            task.wait(0.35)
        end
    end

    if AUTO_UPGRADE then
        statusLbl.Text = "Tat ca da MAX! Auto off"
        AUTO_UPGRADE = false
        autoBtn.Text = "â–¶ AUTO UPGRADE: OFF"
        autoBtn.BackgroundColor3 = Color3.fromRGB(150,50,50)
    end
end

-- NÃºt nÃ¢ng 1 láº§n
manualBtn.MouseButton1Click:Connect(function()
    local towers = getSelectedTowers()
    if #towers == 0 then statusLbl.Text = "Khong co thap!"; return end
    doUpgradeBalanced(towers)
    statusLbl.Text = "Da nang " .. #towers .. " thap!"
end)

-- ============================================================
-- VÃ’NG Láº¶P AUTO UPGRADE
-- ============================================================
task.spawn(function()
    while true do
        task.wait(UPGRADE_DELAY)
        if not AUTO_UPGRADE then continue end

        local towers = getSelectedTowers()
        if #towers == 0 then
            statusLbl.Text = "Chua quet thap"
            continue
        end

        if MODE == "Balanced" then
            doUpgradeBalanced(towers)
            statusLbl.Text = "Balanced: " .. #towers .. " thap"
        else
            doUpgradeFocus(towers)
            statusLbl.Text = "Focus: " .. #towers .. " thap"
        end
    end
end)

-- QuÃ©t ngay lÃºc khá»Ÿi Ä‘á»™ng
task.delay(1, rebuildCheckboxes)
print("[TowerV10] Da chay!")
